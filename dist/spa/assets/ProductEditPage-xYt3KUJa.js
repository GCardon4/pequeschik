import{au as _,a as q,aa as P,r as u,v as w,G as U,f as h,o as p,w as d,i as b,t as s,g as o,a7 as k,ab as C,a8 as S,n as E,a9 as n,aw as B,Q as y}from"./index-BB96JGY1.js";import{Q as I}from"./QImg-BlAVicqI.js";import{Q as z,a as F}from"./QEditor-DX6q50jr.js";import{Q as N}from"./use-fullscreen-C6vDUDv9.js";import{Q as R}from"./QForm-z-5vlO3q.js";import{Q as M}from"./QSpinnerGears-XG-oEWSF.js";import{Q as G}from"./QPage-B-PUJehg.js";import{u as A}from"./productStore-DYrjM-gI.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-DqNZAndx.js";import"./selection-BMSpwXo_.js";import"./format-DOMM40M5.js";import"./QTooltip-CWQrXSPq.js";const L={key:0,class:"q-pa-md"},O={class:"row q-col-gutter-md"},T={class:"col-xs-12 col-md-4"},$={class:"absolute-full flex flex-center bg-grey-3 text-grey-8"},j={class:"col-xs-12 col-md-8"},H={class:"q-mt-lg"},J={key:1,class:"flex flex-center",style:{height:"80vh"}},K={__name:"ProductEditPage",setup(W){const m=_(),v=q(),V=P(),r=A(),l=u(null),i=u(null),f=u(null),g=u([]),c=u(!1);w(async()=>{const t=V.params.id;await r.fetchCategories(),g.value=r.categories.map(e=>({label:e.name,value:e.id})),await r.fetchProductById(t),r.currentProduct?l.value={...r.currentProduct}:(m.notify({color:"negative",message:"No se pudo cargar el producto.",icon:"error"}),v.push({name:"product-list"}))});const Q=t=>{if(i.value=t,t){const e=new FileReader;e.onload=a=>{f.value=a.target.result},e.readAsDataURL(t)}},x=async()=>{c.value=!0;try{await r.updateProduct(l.value,i.value),m.notify({color:"positive",message:"Producto actualizado con éxito.",icon:"check_circle"}),v.push({name:"product-list"})}catch(t){console.error("Error al actualizar el producto:",t),m.notify({color:"negative",message:"Error al actualizar el producto. "+(t.message||"Por favor, intente de nuevo."),icon:"error"})}finally{c.value=!1}};return U(()=>r.currentProduct,t=>{t&&(l.value={...t})}),(t,e)=>(p(),h(G,{padding:""},{default:d(()=>[l.value?(p(),b("div",L,[e[9]||(e[9]=s("div",{class:"text-h4 q-mb-md"},"Editar Producto",-1)),o(k,null,{default:d(()=>[o(C,null,{default:d(()=>[o(R,{onSubmit:S(x,["prevent"])},{default:d(()=>[s("div",O,[s("div",T,[o(I,{src:f.value||l.value.avatar_url,style:{"max-height":"300px","border-radius":"8px"},fit:"contain",class:"q-mb-md"},{error:d(()=>[s("div",$,[o(E,{name:"image",size:"3rem"}),e[8]||(e[8]=s("div",null,"No hay imagen",-1))])]),_:1},8,["src"]),o(z,{modelValue:i.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>i.value=a),Q],label:"Cambiar imagen principal",accept:"image/*",filled:"",capture:"camera",style:{"max-width":"400px"}},null,8,["modelValue"])]),s("div",j,[o(n,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.name=a),label:"Nombre del Producto",filled:"",rules:[a=>!!a||"El nombre es requerido"]},null,8,["modelValue","rules"]),o(n,{modelValue:l.value.reference,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.reference=a),label:"Referencia",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(F,{modelValue:l.value.description,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.description=a),label:"Descripción",filled:"",class:"q-mt-md","min-height":"150px"},null,8,["modelValue"]),o(N,{modelValue:l.value.category_id,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.category_id=a),options:g.value,label:"Categoría","emit-value":"","map-options":"",filled:"",class:"q-mt-md",rules:[a=>a!==null||"La categoría es requerida"]},null,8,["modelValue","options","rules"]),o(n,{modelValue:l.value.price,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.price=a),modelModifiers:{number:!0},label:"Precio",type:"number",step:"0.01",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(n,{modelValue:l.value.stock_quantity,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.stock_quantity=a),modelModifiers:{number:!0},label:"Cantidad en Stock",type:"number",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(B,{modelValue:l.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.is_active=a),label:"Producto Activo",class:"q-mt-md"},null,8,["modelValue"])])]),s("div",H,[o(y,{label:"Guardar Cambios",type:"submit",color:"primary",loading:c.value},null,8,["loading"]),o(y,{label:"Cancelar",color:"grey",class:"q-ml-sm",to:{name:"product-list"}})])]),_:1})]),_:1})]),_:1})])):(p(),b("div",J,[o(M,{size:"50px",color:"primary"})]))]),_:1}))}},ne=D(K,[["__scopeId","data-v-e254d782"]]);export{ne as default};
