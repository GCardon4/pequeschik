import{d,s,u as c}from"./index-eF1tfxb5.js";const g=d("productStore",{state:()=>({products:[],categories:[],selectedProduct:null,loading:!1,error:null}),getters:{getAllProducts:t=>t.products,getAllCategories:t=>t.categories,getLoadingStatus:t=>t.loading,getError:t=>t.error,getFilteredProducts:t=>t.selectedCategory?t.products.filter(r=>r.category&&r.category.id===t.selectedCategory):t.products},actions:{async fetchAllProducts(){this.loading=!0,this.error=null;try{const{data:t,error:r}=await s.from("products").select("*, category:categories(id, name)");if(r)throw r;const e="https://iqnxgapixnukuqpwftfn.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";this.products=t.map(a=>({...a,avatar_url:a.avatar_url||e}))}catch(t){this.error=t.message}finally{this.loading=!1}},async fetchProductById(t){this.loading=!0,this.error=null;try{const{data:r,error:e}=await s.from("products").select("*, category:categories(id, name)").eq("id",t).single();if(e)throw e;const a="https://iqnxgapixnukuqpwftfn.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";r&&(this.selectedProduct={...r,avatar_url:r.avatar_url||a})}catch(r){this.error=r.message}finally{this.loading=!1}},async createProduct(t){this.loading=!0,this.error=null;try{const{data:r,error:e}=await s.from("products").insert(t).select().single();if(e)throw e;return this.products.push(r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async updateProduct(t){this.loading=!0,this.error=null;try{const{id:r,...e}=t,{data:a,error:o}=await s.from("products").update(e).eq("id",r).select("*, category:categories(id, name)").single();if(o)throw o;const i=this.products.findIndex(l=>l.id===r);i!==-1&&(this.products[i]=a),this.selectedProduct&&this.selectedProduct.id===r&&(this.selectedProduct=a)}catch(r){throw this.error=r.message,console.error("Error updating product:",r.message),r}finally{this.loading=!1}},async deleteProduct(t){this.loading=!0,this.error=null;try{const{error:r}=await s.from("products").delete().eq("id",t);if(r)throw r;this.products=this.products.filter(e=>e.id!==t)}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async fetchAllCategories(){this.loading=!0,this.error=null;try{const{data:t,error:r}=await s.from("categories").select("id, name, icon");if(r)throw r;this.categories=t}catch(t){this.error=t.message}finally{this.loading=!1}},setSelectedCategory(t){this.selectedCategory=t},async uploadAvatarImage(t,r){if(this.loading=!0,this.error=null,!c().user)throw new Error("Usuario no autenticado.");try{const a=`products/${r}/${Date.now()}_${t.name}`,{error:o}=await s.storage.from("avatars").upload(a,t);if(o)throw o;const{data:i}=s.storage.from("avatars").getPublicUrl(a);return i.publicUrl}catch(a){throw this.error=a.message,a}finally{this.loading=!1}},async fetchGallery(t){this.loading=!0,this.error=null;try{const{data:r,error:e}=await s.from("product_images").select("id, image_url").eq("product_id",t);if(e)throw e;return r||[]}catch(r){return this.error=r.message,console.error("Error fetching gallery:",r.message),[]}finally{this.loading=!1}},async uploadGalleryImages(t,r){if(!c().user)throw new Error("Usuario no autenticado.");this.loading=!0,this.error=null;const a=r.map(async o=>{const i=`gallery/${t}/${Date.now()}_${o.name}`,{error:l}=await s.storage.from("avatars").upload(i,o);if(l)throw l;const{data:n}=s.storage.from("avatars").getPublicUrl(i);return{product_id:t,image_url:n.publicUrl}});try{const o=await Promise.all(a),{data:i,error:l}=await s.from("product_images").insert(o).select();if(l)throw l;return i}catch(o){throw this.error=o.message,console.error("Error subiendo imágenes a galería:",o.message),o}finally{this.loading=!1}},async deleteGalleryImage(t){this.loading=!0,this.error=null;try{const{error:r}=await s.from("product_images").delete().eq("id",t);if(r)throw r}catch(r){throw this.error=r.message,console.error("Error eliminando imagen de galería:",r.message),r}finally{this.loading=!1}}}});export{g as u};
