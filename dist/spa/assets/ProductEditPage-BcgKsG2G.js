import{Q as L,a as p}from"./QForm-DewzoOF-.js";import{Q as N}from"./QSelect-BrxwOrqf.js";import{u as T,Q as q}from"./use-quasar-CMCKhrmO.js";import{Q as P}from"./QImg-BUxwtWIw.js";import{q as $,z as M,b,v as Q,a3 as O,am as j,a4 as H,a as J,r as f,p as K,f as C,o as c,w as u,n as v,a0 as U,g as a,a2 as W,al as X,Q as k,i as w,F as Y,k as Z,h as ee}from"./index-B0f3dEv-.js";import{Q as h}from"./QCardSection-qe6TEEXt.js";import{Q as ae}from"./QSeparator-Dptsua41.js";import{Q as z}from"./QSpinnerGears-DYKMq5Xn.js";import{u as le,a as te}from"./use-dark-DlWYTmWW.js";import{u as oe,d as re}from"./QDialog-CcnHyBmY.js";import{a as se,b as ne}from"./format-G86KGhsL.js";import{Q as ue}from"./QCard-DEKXFLqq.js";import{Q as ie}from"./QPage-DN2uWkHp.js";import{u as de}from"./productStore-CUtaZJBA.js";import"./use-key-composition-BIBOpLlr.js";import"./focus-manager-zjdVGI5d.js";import"./selection-CSvfesfe.js";import"./use-timeout-C3av2hFP.js";const _=$({name:"QInnerLoading",props:{...le,...oe,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(s,{slots:y}){const S=M(),i=te(s,S.proxy.$q),{transitionProps:r,transitionStyle:l}=re(s),d=b(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(i.value===!0?" q-inner-loading--dark":"")),V=b(()=>"q-inner-loading__label"+(s.labelClass!==void 0?` ${s.labelClass}`:""));function m(){const g=[Q(j,{size:s.size,color:s.color})];return s.label!==void 0&&g.push(Q("div",{class:V.value,style:s.labelStyle},[s.label])),g}function n(){return s.showing===!0?Q("div",{class:d.value,style:l.value},y.default!==void 0?y.default():m()):null}return()=>Q(O,r.value,n)}}),me={class:"row q-gutter-md"},ce={class:"row items-center q-gutter-md"},ve={class:"q-mt-lg"},ge={class:"row items-start q-gutter-md q-mb-md"},pe={key:0,class:"row q-gutter-md"},fe={key:1},Ge={__name:"ProductEditPage",setup(s){const y=H(),S=J(),i=T(),r=de(),l=f(null),d=f(null),V=f(null),m=f([]),n=f([]),g=f(!1),I=b(()=>r.getLoadingStatus),F=b(()=>r.getAllCategories),x=b(()=>d.value?URL.createObjectURL(d.value):l.value?.avatar_url);K(async()=>{const o=y.params.id;await Promise.all([r.fetchProductById(o),r.fetchAllCategories()]);const e=r.selectedProduct;e&&(l.value={id:e.id,name:e.name,reference:e.reference,avatar_url:e.avatar_url,category:e.category||null,subcategory:e.subcategory||"",sizes:e.sizes||"",price:e.price||0,stock:e.stock||0}),A()});async function A(){g.value=!0;const o=y.params.id;m.value=await r.fetchGallery(o),g.value=!1}async function E(){if(!n.value||n.value.length===0)return;const o=l.value.id;try{const e=await r.uploadGalleryImages(o,n.value);m.value.push(...e),n.value=[],i.notify({color:"positive",message:"Imágenes subidas correctamente."})}catch(e){i.notify({color:"negative",message:"Error al subir imágenes.",error:e})}}function G(o){i.dialog({title:"Confirmar",message:"¿Estás seguro de eliminar esta imagen?",cancel:!0}).onOk(async()=>{try{await r.deleteGalleryImage(o),m.value=m.value.filter(e=>e.id!==o),i.notify({color:"positive",message:"Imagen eliminada."})}catch(e){i.notify({color:"negative",message:"Error al eliminar la imagen.",error:e})}})}const B=o=>{d.value=o},R=()=>{V.value.pickFiles()};async function D(){try{let o=l.value.avatar_url;d.value&&(o=await r.uploadAvatarImage(d.value));const e={...l.value,avatar_url:o,category_id:l.value.category?.id};delete e.category,await r.updateProduct(e),i.notify({color:"positive",message:"Producto actualizado."}),S.push({name:"product-list"})}catch(o){i.notify({color:"negative",message:"Error al actualizar el producto.",error:o})}}return(o,e)=>(c(),C(ie,{class:"q-pa-md"},{default:u(()=>[e[12]||(e[12]=v("div",{class:"text-h4 q-mb-md"},"Editar Producto",-1)),l.value?(c(),C(ue,{key:0},{default:u(()=>[a(h,null,{default:u(()=>[a(L,{onSubmit:W(D,["prevent"]),class:"q-gutter-md"},{default:u(()=>[a(p,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),label:"Nombre",filled:""},null,8,["modelValue"]),a(p,{modelValue:l.value.reference,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.reference=t),label:"Referencia",filled:""},null,8,["modelValue"]),a(N,{modelValue:l.value.category,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.category=t),options:F.value,"option-label":"name",label:"Categoría",filled:""},null,8,["modelValue","options"]),a(p,{modelValue:l.value.subcategory,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.subcategory=t),label:"Subcategoría",filled:""},null,8,["modelValue"]),a(p,{modelValue:l.value.sizes,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.sizes=t),label:"Tallas",filled:""},null,8,["modelValue"]),v("div",me,[a(p,{modelValue:l.value.price,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.price=t),modelModifiers:{number:!0},label:"Precio",type:"number",filled:"",prefix:"COP $",class:"col"},null,8,["modelValue"]),a(p,{modelValue:l.value.stock,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.stock=t),modelModifiers:{number:!0},label:"Stock",type:"number",filled:"",class:"col"},null,8,["modelValue"])]),e[9]||(e[9]=v("div",{class:"text-subtitle1 q-mt-md"},"Avatar del Producto",-1)),v("div",ce,[a(q,{ref_key:"fileInputRef",ref:V,modelValue:d.value,"onUpdate:modelValue":[e[7]||(e[7]=t=>d.value=t),B],label:"Seleccionar nueva imagen",accept:"image/*",filled:"",style:{"max-width":"300px"}},null,8,["modelValue"]),x.value?(c(),C(X,{key:0,size:"100px",class:"cursor-pointer",onClick:R},{default:u(()=>[a(P,{src:x.value,ratio:"1"},null,8,["src"])]),_:1})):U("",!0)]),v("div",ve,[a(k,{label:"Actualizar Producto",type:"submit",color:"primary",loading:I.value},null,8,["loading"]),a(k,{label:"Cancelar",color:"grey",class:"q-ml-sm",to:{name:"product-list"}})])]),_:1})]),_:1}),a(ae),a(h,null,{default:u(()=>[e[11]||(e[11]=v("div",{class:"text-h6 q-mb-md"},"Galería de Imágenes",-1)),v("div",ge,[a(q,{modelValue:n.value,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value=t),label:"Añadir imágenes a la galería",accept:"image/*",filled:"",multiple:"",style:{flex:"1"}},null,8,["modelValue"]),a(k,{label:"Subir",color:"secondary",onClick:E,disable:!n.value||n.value.length===0,loading:I.value},null,8,["disable","loading"])]),a(_,{showing:g.value},{default:u(()=>[a(z,{size:"50px",color:"primary"})]),_:1},8,["showing"]),m.value.length>0?(c(),w("div",pe,[(c(!0),w(Y,null,Z(m.value,t=>(c(),w("div",{key:t.id,class:"relative-position"},[a(P,{src:t.image_url,width:"150px",height:"150px",fit:"cover",class:"rounded-borders"},null,8,["src"]),a(k,{flat:"",dense:"",round:"",color:"negative",icon:"delete",class:"absolute-top-right",style:{background:"rgba(0,0,0,0.5)"},onClick:ye=>G(t.id)},null,8,["onClick"])]))),128))])):(c(),w("div",fe,[a(se,null,{default:u(()=>[a(ne,{class:"text-grey"},{default:u(()=>[...e[10]||(e[10]=[ee("Este producto aún no tiene imágenes en la galería.",-1)])]),_:1})]),_:1})]))]),_:1})]),_:1})):U("",!0),a(_,{showing:I.value||!l.value},{default:u(()=>[a(z,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1}))}};export{Ge as default};
