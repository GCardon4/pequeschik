import{Q as L,a as c}from"./QForm-B058pbAj.js";import{b as N,Q as T}from"./use-quasar-DCNddLgv.js";import{Q as q}from"./QFile-mJeBWVp5.js";import{Q as P}from"./QImg-BO7HGhzx.js";import{q as $,z as M,b,v as Q,a3 as O,am as j,a4 as H,a as J,r as f,p as K,f as C,o as v,w as i,n as g,a0 as U,g as a,a2 as W,al as X,Q as k,i as w,F as Y,k as Z,h as ee}from"./index-eF1tfxb5.js";import{Q as z}from"./QCardSection-C8OqjwBL.js";import{Q as le}from"./QSeparator-G5jSf6-i.js";import{Q as h}from"./QSpinnerGears-BlFtP82a.js";import{u as ae,a as te}from"./use-dark-CwhEGbSz.js";import{u as oe,d as re}from"./QDialog-Bf7oFLCu.js";import{a as se,b as ne}from"./format-BxU65xB3.js";import{Q as ie}from"./QCard-CdvORZn1.js";import{Q as ue}from"./QPage-Do2V5iIH.js";import{u as de}from"./productStore-Ch9hK29T.js";import"./use-key-composition-DUdREvpp.js";import"./focus-manager-zjdVGI5d.js";import"./selection-CMbmD-yi.js";import"./use-timeout-DsHolzV1.js";const _=$({name:"QInnerLoading",props:{...ae,...oe,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(s,{slots:y}){const S=M(),u=te(s,S.proxy.$q),{transitionProps:r,transitionStyle:l}=re(s),d=b(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(u.value===!0?" q-inner-loading--dark":"")),V=b(()=>"q-inner-loading__label"+(s.labelClass!==void 0?` ${s.labelClass}`:""));function m(){const p=[Q(j,{size:s.size,color:s.color})];return s.label!==void 0&&p.push(Q("div",{class:V.value,style:s.labelStyle},[s.label])),p}function n(){return s.showing===!0?Q("div",{class:d.value,style:l.value},y.default!==void 0?y.default():m()):null}return()=>Q(O,r.value,n)}}),me={class:"row q-gutter-md"},ce={class:"row items-center q-gutter-md"},ve={class:"q-mt-lg"},ge={class:"row items-start q-gutter-md q-mb-md"},pe={key:0,class:"row q-gutter-md"},fe={key:1},Ge={__name:"ProductEditPage",setup(s){const y=H(),S=J(),u=N(),r=de(),l=f(null),d=f(null),V=f(null),m=f([]),n=f([]),p=f(!1),I=b(()=>r.getLoadingStatus),F=b(()=>r.getAllCategories),x=b(()=>d.value?URL.createObjectURL(d.value):l.value?.avatar_url);K(async()=>{const o=y.params.id;await Promise.all([r.fetchProductById(o),r.fetchAllCategories()]);const e=r.selectedProduct;e&&(l.value={id:e.id,name:e.name,reference:e.reference,description:e.description,avatar_url:e.avatar_url,category:e.category||null,subcategory:e.subcategory||"",sizes:e.sizes||"",price:e.price||0,stock:e.stock||0}),A()});async function A(){p.value=!0;const o=y.params.id;m.value=await r.fetchGallery(o),p.value=!1}async function E(){if(!n.value||n.value.length===0)return;const o=l.value.id;try{const e=await r.uploadGalleryImages(o,n.value);m.value.push(...e),n.value=[],u.notify({color:"positive",message:"Imágenes subidas correctamente."})}catch(e){u.notify({color:"negative",message:"Error al subir imágenes.",error:e})}}function G(o){u.dialog({title:"Confirmar",message:"¿Estás seguro de eliminar esta imagen?",cancel:!0}).onOk(async()=>{try{await r.deleteGalleryImage(o),m.value=m.value.filter(e=>e.id!==o),u.notify({color:"positive",message:"Imagen eliminada."})}catch(e){u.notify({color:"negative",message:"Error al eliminar la imagen.",error:e})}})}const B=o=>{d.value=o},D=()=>{V.value.pickFiles()};async function R(){try{let o=l.value.avatar_url;d.value&&(o=await r.uploadAvatarImage(d.value,l.value.id));const e={...l.value,avatar_url:o,category_id:l.value.category?.id};delete e.category,await r.updateProduct(e),u.notify({color:"positive",message:"Producto actualizado."}),S.push({name:"product-list"})}catch(o){u.notify({color:"negative",message:"Error al actualizar el producto.",error:o})}}return(o,e)=>(v(),C(ue,{class:"q-pa-md"},{default:i(()=>[e[13]||(e[13]=g("div",{class:"text-h4 q-mb-md"},"Editar Producto",-1)),l.value?(v(),C(ie,{key:0},{default:i(()=>[a(z,null,{default:i(()=>[a(L,{onSubmit:W(R,["prevent"]),class:"q-gutter-md"},{default:i(()=>[a(c,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),label:"Nombre",filled:""},null,8,["modelValue"]),a(c,{modelValue:l.value.reference,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.reference=t),label:"Referencia",filled:""},null,8,["modelValue"]),a(c,{modelValue:l.value.description,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.description=t),label:"Descripcion",filled:""},null,8,["modelValue"]),a(T,{modelValue:l.value.category,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.category=t),options:F.value,"option-label":"name",label:"Categoría",filled:""},null,8,["modelValue","options"]),a(c,{modelValue:l.value.subcategory,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.subcategory=t),label:"Subcategoría",filled:""},null,8,["modelValue"]),a(c,{modelValue:l.value.sizes,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.sizes=t),label:"Tallas",filled:""},null,8,["modelValue"]),g("div",me,[a(c,{modelValue:l.value.price,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.price=t),modelModifiers:{number:!0},label:"Precio",type:"number",filled:"",prefix:"COP $",class:"col"},null,8,["modelValue"]),a(c,{modelValue:l.value.stock,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.stock=t),modelModifiers:{number:!0},label:"Stock",type:"number",filled:"",class:"col"},null,8,["modelValue"])]),e[10]||(e[10]=g("div",{class:"text-subtitle1 q-mt-md"},"Avatar del Producto",-1)),g("div",ce,[a(q,{ref_key:"fileInputRef",ref:V,modelValue:d.value,"onUpdate:modelValue":[e[8]||(e[8]=t=>d.value=t),B],label:"Seleccionar nueva imagen",accept:"image/*",filled:"",style:{"max-width":"300px"}},null,8,["modelValue"]),x.value?(v(),C(X,{key:0,size:"100px",class:"cursor-pointer",onClick:D},{default:i(()=>[a(P,{src:x.value,ratio:"1"},null,8,["src"])]),_:1})):U("",!0)]),g("div",ve,[a(k,{label:"Actualizar Producto",type:"submit",color:"primary",loading:I.value},null,8,["loading"]),a(k,{label:"Cancelar",color:"grey",class:"q-ml-sm",to:{name:"product-list"}})])]),_:1})]),_:1}),a(le),a(z,null,{default:i(()=>[e[12]||(e[12]=g("div",{class:"text-h6 q-mb-md"},"Galería de Imágenes",-1)),g("div",ge,[a(q,{modelValue:n.value,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value=t),label:"Añadir imágenes a la galería",accept:"image/*",filled:"",multiple:"",style:{flex:"1"}},null,8,["modelValue"]),a(k,{label:"Subir",color:"secondary",onClick:E,disable:!n.value||n.value.length===0,loading:I.value},null,8,["disable","loading"])]),a(_,{showing:p.value},{default:i(()=>[a(h,{size:"50px",color:"primary"})]),_:1},8,["showing"]),m.value.length>0?(v(),w("div",pe,[(v(!0),w(Y,null,Z(m.value,t=>(v(),w("div",{key:t.id,class:"relative-position"},[a(P,{src:t.image_url,width:"150px",height:"150px",fit:"cover",class:"rounded-borders"},null,8,["src"]),a(k,{flat:"",dense:"",round:"",color:"negative",icon:"delete",class:"absolute-top-right",style:{background:"rgba(0,0,0,0.5)"},onClick:ye=>G(t.id)},null,8,["onClick"])]))),128))])):(v(),w("div",fe,[a(se,null,{default:i(()=>[a(ne,{class:"text-grey"},{default:i(()=>[...e[11]||(e[11]=[ee("Este producto aún no tiene imágenes en la galería.",-1)])]),_:1})]),_:1})]))]),_:1})]),_:1})):U("",!0),a(_,{showing:I.value||!l.value},{default:i(()=>[a(h,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1}))}};export{Ge as default};
