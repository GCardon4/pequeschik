import{d,s,u as c}from"./index-BB96JGY1.js";const g=d("productStore",{state:()=>({products:[],categories:[],selectedProduct:null,loading:!1,error:null}),getters:{getAllProducts:e=>e.products,getAllCategories:e=>e.categories,getLoadingStatus:e=>e.loading,getError:e=>e.error,getFilteredProducts:e=>e.selectedCategory?e.products.filter(r=>r.category&&r.category.id===e.selectedCategory):e.products},actions:{async fetchAllProducts(){this.loading=!0,this.error=null;try{const{data:e,error:r}=await s.from("products").select("*, category:categories(id, name)");if(r)throw r;const a="https://iqnxgapixnukuqpwftfn.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";this.products=e.map(t=>({...t,name:t.name||"",reference:t.reference||"",description:t.description||"",avatar_url:t.avatar_url||a}))}catch(e){this.error=e.message}finally{this.loading=!1}},async fetchProductById(e){this.loading=!0,this.error=null;try{const{data:r,error:a}=await s.from("products").select("*, category:categories(id, name)").eq("id",e).single();if(a)throw a;const t="https://iqnxgapixnukuqpwftfn.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";r&&(this.selectedProduct={...r,avatar_url:r.avatar_url||t})}catch(r){this.error=r.message}finally{this.loading=!1}},async createProduct(e){this.loading=!0,this.error=null;try{const{data:r,error:a}=await s.from("products").insert(e).select().single();if(a)throw a;return this.products.push(r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async updateProduct(e){this.loading=!0,this.error=null;try{const{id:r,...a}=e,{data:t,error:o}=await s.from("products").update(a).eq("id",r).select("*, category:categories(id, name)").single();if(o)throw o;const i=this.products.findIndex(l=>l.id===r);i!==-1&&(this.products[i]=t),this.selectedProduct&&this.selectedProduct.id===r&&(this.selectedProduct=t)}catch(r){throw this.error=r.message,console.error("Error updating product:",r.message),r}finally{this.loading=!1}},async deleteProduct(e){this.loading=!0,this.error=null;try{const{error:r}=await s.from("products").delete().eq("id",e);if(r)throw r;this.products=this.products.filter(a=>a.id!==e)}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async fetchAllCategories(){this.loading=!0,this.error=null;try{const{data:e,error:r}=await s.from("categories").select("id, name, icon");if(r)throw r;this.categories=e}catch(e){this.error=e.message}finally{this.loading=!1}},setSelectedCategory(e){this.selectedCategory=e},async uploadAvatarImage(e,r){if(this.loading=!0,this.error=null,!c().user)throw new Error("Usuario no autenticado.");try{const t=`products/${r}/${Date.now()}_${e.name}`,{error:o}=await s.storage.from("avatars").upload(t,e);if(o)throw o;const{data:i}=s.storage.from("avatars").getPublicUrl(t);return i.publicUrl}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},async fetchGallery(e){this.loading=!0,this.error=null;try{const{data:r,error:a}=await s.from("product_images").select("id, image_url").eq("product_id",e);if(a)throw a;return r||[]}catch(r){return this.error=r.message,console.error("Error fetching gallery:",r.message),[]}finally{this.loading=!1}},async uploadGalleryImages(e,r){if(!c().user)throw new Error("Usuario no autenticado.");this.loading=!0,this.error=null;const t=r.map(async o=>{const i=`gallery/${e}/${Date.now()}_${o.name}`,{error:l}=await s.storage.from("avatars").upload(i,o);if(l)throw l;const{data:n}=s.storage.from("avatars").getPublicUrl(i);return{product_id:e,image_url:n.publicUrl}});try{const o=await Promise.all(t),{data:i,error:l}=await s.from("product_images").insert(o).select();if(l)throw l;return i}catch(o){throw this.error=o.message,console.error("Error subiendo imágenes a galería:",o.message),o}finally{this.loading=!1}},async deleteGalleryImage(e){this.loading=!0,this.error=null;try{const{error:r}=await s.from("product_images").delete().eq("id",e);if(r)throw r}catch(r){throw this.error=r.message,console.error("Error eliminando imagen de galería:",r.message),r}finally{this.loading=!1}}}});export{g as u};
