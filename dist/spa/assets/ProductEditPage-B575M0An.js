import{a as _,a3 as q,r as u,p as P,I as w,f as U,o as p,w as i,i as b,n as s,g as o,a2 as h,l as k,Q as y}from"./index-DRg9g1vX.js";import{Q as C}from"./QImg-BF2cFclf.js";import{Q as S,a as E,b as I}from"./QToggle-OedJx1bz.js";import{Q as B,a as n}from"./QForm-Bb-uwiC3.js";import{i as z,Q as F}from"./use-quasar-Dx-yCSXX.js";import{Q as N}from"./QCardSection-0caMwbFv.js";import{Q as R}from"./QCard-CnWs91_S.js";import{Q as M}from"./QSpinnerGears-N1ybW25U.js";import{Q as A}from"./QPage-Bly9c7C9.js";import{u as D}from"./productStore-CYCjIWKg.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-timeout-8iYzss33.js";import"./QDialog-Cwu0fu7V.js";import"./selection-n5EXbK2P.js";import"./use-dark-BA2Gvzb3.js";import"./focus-manager-zjdVGI5d.js";import"./use-key-composition-v6eh3HGp.js";import"./format-CDN244_G.js";import"./QTooltip-Bl8pvChp.js";const L={key:0,class:"q-pa-md"},O={class:"row q-col-gutter-md"},T={class:"col-xs-12 col-md-4"},$={class:"absolute-full flex flex-center bg-grey-3 text-grey-8"},j={class:"col-xs-12 col-md-8"},H={class:"q-mt-lg"},J={key:1,class:"flex flex-center",style:{height:"80vh"}},K={__name:"ProductEditPage",setup(W){const m=z(),v=_(),V=q(),r=D(),a=u(null),d=u(null),f=u(null),g=u([]),c=u(!1);P(async()=>{const t=V.params.id;await r.fetchCategories(),g.value=r.categories.map(e=>({label:e.name,value:e.id})),await r.fetchProductById(t),r.currentProduct?a.value={...r.currentProduct}:(m.notify({color:"negative",message:"No se pudo cargar el producto.",icon:"error"}),v.push({name:"product-list"}))});const Q=t=>{if(d.value=t,t){const e=new FileReader;e.onload=l=>{f.value=l.target.result},e.readAsDataURL(t)}},x=async()=>{c.value=!0;try{await r.updateProduct(a.value,d.value),m.notify({color:"positive",message:"Producto actualizado con éxito.",icon:"check_circle"}),v.push({name:"product-list"})}catch(t){console.error("Error al actualizar el producto:",t),m.notify({color:"negative",message:"Error al actualizar el producto. "+(t.message||"Por favor, intente de nuevo."),icon:"error"})}finally{c.value=!1}};return w(()=>r.currentProduct,t=>{t&&(a.value={...t})}),(t,e)=>(p(),U(A,{padding:""},{default:i(()=>[a.value?(p(),b("div",L,[e[9]||(e[9]=s("div",{class:"text-h4 q-mb-md"},"Editar Producto",-1)),o(R,null,{default:i(()=>[o(N,null,{default:i(()=>[o(B,{onSubmit:h(x,["prevent"])},{default:i(()=>[s("div",O,[s("div",T,[o(C,{src:f.value||a.value.avatar_url,style:{"max-height":"300px","border-radius":"8px"},fit:"contain",class:"q-mb-md"},{error:i(()=>[s("div",$,[o(k,{name:"image",size:"3rem"}),e[8]||(e[8]=s("div",null,"No hay imagen",-1))])]),_:1},8,["src"]),o(S,{modelValue:d.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>d.value=l),Q],label:"Cambiar imagen principal",accept:"image/*",filled:"",capture:"camera",style:{"max-width":"400px"}},null,8,["modelValue"])]),s("div",j,[o(n,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.name=l),label:"Nombre del Producto",filled:"",rules:[l=>!!l||"El nombre es requerido"]},null,8,["modelValue","rules"]),o(n,{modelValue:a.value.reference,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.reference=l),label:"Referencia",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(E,{modelValue:a.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.description=l),label:"Descripción",filled:"",class:"q-mt-md","min-height":"150px"},null,8,["modelValue"]),o(F,{modelValue:a.value.category_id,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.category_id=l),options:g.value,label:"Categoría","emit-value":"","map-options":"",filled:"",class:"q-mt-md",rules:[l=>l!==null||"La categoría es requerida"]},null,8,["modelValue","options","rules"]),o(n,{modelValue:a.value.price,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.price=l),modelModifiers:{number:!0},label:"Precio",type:"number",step:"0.01",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(n,{modelValue:a.value.stock_quantity,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.stock_quantity=l),modelModifiers:{number:!0},label:"Cantidad en Stock",type:"number",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(I,{modelValue:a.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.is_active=l),label:"Producto Activo",class:"q-mt-md"},null,8,["modelValue"])])]),s("div",H,[o(y,{label:"Guardar Cambios",type:"submit",color:"primary",loading:c.value},null,8,["loading"]),o(y,{label:"Cancelar",color:"grey",class:"q-ml-sm",to:{name:"product-list"}})])]),_:1})]),_:1})]),_:1})])):(p(),b("div",J,[o(M,{size:"50px",color:"primary"})]))]),_:1}))}},ge=G(K,[["__scopeId","data-v-e254d782"]]);export{ge as default};
