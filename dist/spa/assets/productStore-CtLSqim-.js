import{d,aJ as s,u as n}from"./index-DiEdNpAm.js";const g=d("productStore",{state:()=>({products:[],categories:[],selectedProduct:null,loading:!1,error:null}),getters:{getAllProducts:r=>r.products,getAllCategories:r=>r.categories,getLoadingStatus:r=>r.loading,getError:r=>r.error,getFilteredProducts:r=>r.selectedCategory?r.products.filter(e=>e.category.id===r.selectedCategory):r.products},actions:{async fetchAllProducts(){this.loading=!0,this.error=null;try{const{data:r,error:e}=await s.from("products").select("*, category:categories(id, name)");if(e)throw e;const t="https://vssnhqhfasirinocufbs.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";this.products=r.map(o=>({...o,avatar_url:o.avatar_url||t}))}catch(r){this.error=r.message}finally{this.loading=!1}},async fetchProductById(r){this.loading=!0,this.error=null;try{const{data:e,error:t}=await s.from("products").select("*, category:categories(id, name)").eq("id",r).single();if(t)throw t;const o="https://vssnhqhfasirinocufbs.supabase.co/storage/v1/object/public/avatars/avatar-img-default.png";this.selectedProduct={...e,avatar_url:e.avatar_url||o}}catch(e){this.error=e.message}finally{this.loading=!1}},async createProduct(r){this.loading=!0,this.error=null;try{const{data:e,error:t}=await s.from("products").insert(r).select().single();if(t)throw t;return this.products.push(e),e}catch(e){throw this.error=e.message,console.error("Error Creando el Producto:",e.message),e}finally{this.loading=!1}},async updateProduct(r){this.loading=!0,this.error=null;try{const{data:e,error:t}=await s.from("products").update(r).eq("id",r.id).select("*, category:categories(id, name)").single();if(t)throw t;const o=this.products.findIndex(a=>a.id===r.id);o!==-1&&(this.products[o]=e)}catch(e){this.error=e.message,console.error("Error updating product:",e.message)}finally{this.loading=!1}},async fetchAllCategories(){this.loading=!0,this.error=null;try{const{data:r,error:e}=await s.from("categories").select("id, name, icon");if(e)throw e;this.categories=r,console.log("Categorias cargadss:",r)}catch(r){this.error=r.message,console.error("Error Trayendo Categorías:",r.message)}finally{this.loading=!1}},setSelectedCategory(r){this.selectedCategory=r},async uploadAvatarImage(r){this.loading=!0,this.error=null;const e=n();if(!e.user)throw this.error="Usuario no autenticado. No se puede subir la imagen.",console.error(this.error),this.loading=!1,new Error(this.error);try{const o=`${e.user.id}/${Date.now()}_${r.name}`,{error:a}=await s.storage.from("avatars").upload(o,r);if(a)throw a;const{data:i}=s.storage.from("avatars").getPublicUrl(o);return i.publicUrl}catch(t){throw this.error=t.message,console.error("Error al subir la imagen del avatar:",t.message),t}finally{this.loading=!1}},async fetchGallery(r){this.loading=!0,this.error=null;try{const{data:e,error:t}=await s.from("product_images").select("id, image_url").eq("product_id",r);if(t)throw t;return e||[]}catch(e){return this.error=e.message,console.error("Error fetching gallery:",e.message),[]}finally{this.loading=!1}},async uploadGalleryImages(r,e){if(!n().user)throw new Error("Usuario no autenticado.");this.loading=!0,this.error=null;const o=e.map(async a=>{const i=`gallery/${r}/${Date.now()}_${a.name}`,{error:l}=await s.storage.from("avatars").upload(i,a);if(l)throw l;const{data:c}=s.storage.from("avatars").getPublicUrl(i);return{product_id:r,image_url:c.publicUrl}});try{const a=await Promise.all(o),{data:i,error:l}=await s.from("product_images").insert(a).select();if(l)throw l;return i}catch(a){throw this.error=a.message,console.error("Error subiendo imágenes a galería:",a.message),a}finally{this.loading=!1}},async deleteGalleryImage(r){this.loading=!0,this.error=null;try{const{error:e}=await s.from("product_images").delete().eq("id",r);if(e)throw e}catch(e){throw this.error=e.message,console.error("Error eliminando imagen de galería:",e.message),e}finally{this.loading=!1}}}});export{g as u};
