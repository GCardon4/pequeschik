import{az as _,a as q,aj as P,r as u,q as h,J as k,f as w,o as p,w as i,i as b,p as s,g as o,ag as U,ak as C,ah as S,n as E,ai as n,aB as B,Q as y}from"./index-CEvKOOos.js";import{Q as z}from"./QImg-C2tOMvLs.js";import{Q as I,a as F}from"./QEditor-Ch4aDXiJ.js";import{Q as N}from"./use-fullscreen-lx1jE9zt.js";import{Q as R}from"./QForm-BA9sEay7.js";import{Q as M}from"./QSpinnerGears-Dh7pmCcq.js";import{Q as A}from"./QPage-DgI7XAAt.js";import{u as D}from"./productStore-kIAXihmZ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-Yh1JQf5n.js";import"./selection-DvxNEaLR.js";import"./format-fzmVlmdj.js";import"./QTooltip-Bxy5RpnE.js";const L={key:0,class:"q-pa-md"},j={class:"row q-col-gutter-md"},J={class:"col-xs-12 col-md-4"},O={class:"absolute-full flex flex-center bg-grey-3 text-grey-8"},T={class:"col-xs-12 col-md-8"},$={class:"q-mt-lg"},H={key:1,class:"flex flex-center",style:{height:"80vh"}},K={__name:"ProductEditPage",setup(W){const m=_(),v=q(),V=P(),r=D(),l=u(null),d=u(null),f=u(null),g=u([]),c=u(!1);h(async()=>{const t=V.params.id;await r.fetchCategories(),g.value=r.categories.map(e=>({label:e.name,value:e.id})),await r.fetchProductById(t),r.currentProduct?l.value={...r.currentProduct}:(m.notify({color:"negative",message:"No se pudo cargar el producto.",icon:"error"}),v.push({name:"product-list"}))});const Q=t=>{if(d.value=t,t){const e=new FileReader;e.onload=a=>{f.value=a.target.result},e.readAsDataURL(t)}},x=async()=>{c.value=!0;try{await r.updateProduct(l.value,d.value),m.notify({color:"positive",message:"Producto actualizado con éxito.",icon:"check_circle"}),v.push({name:"product-list"})}catch(t){console.error("Error al actualizar el producto:",t),m.notify({color:"negative",message:"Error al actualizar el producto. "+(t.message||"Por favor, intente de nuevo."),icon:"error"})}finally{c.value=!1}};return k(()=>r.currentProduct,t=>{t&&(l.value={...t})}),(t,e)=>(p(),w(A,{padding:""},{default:i(()=>[l.value?(p(),b("div",L,[e[9]||(e[9]=s("div",{class:"text-h4 q-mb-md"},"Editar Producto",-1)),o(U,null,{default:i(()=>[o(C,null,{default:i(()=>[o(R,{onSubmit:S(x,["prevent"])},{default:i(()=>[s("div",j,[s("div",J,[o(z,{src:f.value||l.value.avatar_url,style:{"max-height":"300px","border-radius":"8px"},fit:"contain",class:"q-mb-md"},{error:i(()=>[s("div",O,[o(E,{name:"image",size:"3rem"}),e[8]||(e[8]=s("div",null,"No hay imagen",-1))])]),_:1},8,["src"]),o(I,{modelValue:d.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>d.value=a),Q],label:"Cambiar imagen principal",accept:"image/*",filled:"",capture:"camera",style:{"max-width":"400px"}},null,8,["modelValue"])]),s("div",T,[o(n,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.name=a),label:"Nombre del Producto",filled:"",rules:[a=>!!a||"El nombre es requerido"]},null,8,["modelValue","rules"]),o(n,{modelValue:l.value.reference,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.reference=a),label:"Referencia",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(F,{modelValue:l.value.description,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.description=a),label:"Descripción",filled:"",class:"q-mt-md","min-height":"150px"},null,8,["modelValue"]),o(N,{modelValue:l.value.category_id,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.category_id=a),options:g.value,label:"Categoría","emit-value":"","map-options":"",filled:"",class:"q-mt-md",rules:[a=>a!==null||"La categoría es requerida"]},null,8,["modelValue","options","rules"]),o(n,{modelValue:l.value.price,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.price=a),modelModifiers:{number:!0},label:"Precio",type:"number",step:"0.01",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(n,{modelValue:l.value.stock_quantity,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.stock_quantity=a),modelModifiers:{number:!0},label:"Cantidad en Stock",type:"number",filled:"",class:"q-mt-md"},null,8,["modelValue"]),o(B,{modelValue:l.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.is_active=a),label:"Producto Activo",class:"q-mt-md"},null,8,["modelValue"])])]),s("div",$,[o(y,{label:"Guardar Cambios",type:"submit",color:"primary",loading:c.value},null,8,["loading"]),o(y,{label:"Cancelar",color:"grey",class:"q-ml-sm",to:{name:"product-list"}})])]),_:1})]),_:1})]),_:1})])):(p(),b("div",H,[o(M,{size:"50px",color:"primary"})]))]),_:1}))}},ne=G(K,[["__scopeId","data-v-e254d782"]]);export{ne as default};
